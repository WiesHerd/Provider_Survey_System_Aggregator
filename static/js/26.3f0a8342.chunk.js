"use strict";(self.webpackChunksurvey_data_processing_system=self.webpackChunksurvey_data_processing_system||[]).push([[26,256],{6256:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});var a=s(2555);const r={NODE_ENV:"production",PUBLIC_URL:"/Provider_Survey_System_Aggregator",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_URL||"http://localhost:3001/api";class l{constructor(){}static getInstance(){return l.instance||(l.instance=new l),l.instance}async getSurveyMeta(e){const t=await fetch("".concat(r,"/survey/").concat(e,"/meta"));if(!t.ok)throw new Error("Failed to fetch survey metadata");return await t.json()}async uploadSurvey(e,t,s,a,l){const i=new FormData;i.append("file",e),i.append("name",t),i.append("year",s.toString()),i.append("type",a);const n=new XMLHttpRequest;return new Promise((e,t)=>{n.open("POST","".concat(r,"/upload")),n.onload=()=>{if(n.status>=200&&n.status<300)try{const t=JSON.parse(n.responseText);e({surveyId:t.surveyId,rowCount:t.rowCount})}catch(s){t(new Error("Invalid server response"))}else t(new Error("Upload failed: ".concat(n.status," ").concat(n.statusText)))},n.onerror=()=>t(new Error("Network error during upload")),n.upload.onprogress=e=>{if(!l||!e.lengthComputable)return;const t=Math.round(e.loaded/e.total*100);l(t)},n.send(i)})}async getAllSurveys(){const e=await fetch("".concat(r,"/surveys"));if(!e.ok)throw new Error("Failed to fetch surveys");return(await e.json()).map(e=>{var t,s,a,r,l,i;return{id:e.id,name:e.name,year:e.year.toString(),type:e.type,uploadDate:e.uploadDate,rowCount:null!==(t=null!==(s=e.rowCount)&&void 0!==s?s:e.row_count)&&void 0!==t?t:0,specialtyCount:null!==(a=null!==(r=e.specialtyCount)&&void 0!==r?r:e.specialty_count)&&void 0!==a?a:0,dataPoints:null!==(l=null!==(i=e.dataPoints)&&void 0!==i?i:e.data_points)&&void 0!==l?l:0,colorAccent:e.colorAccent||"#6366F1",metadata:e.metadata}})}async getSurveyData(e,t,s){const l=new URLSearchParams;null!==t&&void 0!==t&&t.specialty&&l.append("specialty",t.specialty),null!==t&&void 0!==t&&t.providerType&&l.append("providerType",t.providerType),null!==t&&void 0!==t&&t.region&&l.append("region",t.region),null!==s&&void 0!==s&&s.page&&l.append("page",String(s.page)),null!==s&&void 0!==s&&s.limit&&l.append("limit",String(s.limit));const i=await fetch("".concat(r,"/survey/").concat(e,"/data?").concat(l.toString()));if(!i.ok)throw new Error("Failed to fetch survey data");const n=await i.json(),o=(n.data||n).map(e=>(0,a.A)({},e));return{rows:o,pagination:n.pagination?{page:Number(n.pagination.page)||1,limit:Number(n.pagination.limit)||o.length,total:Number(n.pagination.total)||o.length,pages:Number(n.pagination.pages)||1}:void 0}}async getAvailableFiltersForSurvey(e){const t=await fetch("".concat(r,"/survey/").concat(e,"/filters"));if(!t.ok)throw new Error("Failed to fetch filters");return await t.json()}async deleteSurvey(e){if(!(await fetch("".concat(r,"/survey/").concat(e),{method:"DELETE"})).ok)throw new Error("Failed to delete survey")}async deleteAllSurveys(){if(!(await fetch("".concat(r,"/surveys"),{method:"DELETE"})).ok)throw new Error("Failed to delete all surveys")}async exportSurveyData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"csv";const s=await fetch("".concat(r,"/survey/").concat(e,"/export?format=").concat(t));if(!s.ok)throw new Error("Failed to export survey data");return await s.blob()}async healthCheck(){try{return(await fetch("".concat(r,"/health"))).ok}catch(e){return!1}}}l.instance=void 0;const i=l},8026:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var a=s(2555),r=s(5043),l=s(8789),i=s(6365),n=s(2517),o=s(7988),d=s(493),c=s(7591),u=s(7561),m=s(7913),x=s(7970),g=s(6446),p=s(9190),h=s(6256),y=s(579);const v=(0,r.lazy)(()=>Promise.all([s.e(902),s.e(100)]).then(s.bind(s,3100))),f=()=>(0,y.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,y.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),(0,y.jsx)("span",{className:"ml-2 text-gray-600",children:"Loading data table..."})]}),b=e=>{const{displayName:t,onPinColumn:s,colId:a,isSpecialty:l,isNumeric:i}=e,[n,o]=(0,r.useState)(!1);return(0,y.jsxs)("div",{className:"flex items-center w-full ".concat(i?"justify-end":"justify-between"),children:[(0,y.jsx)("span",{className:"truncate ".concat(l?"font-semibold":""," ").concat(i?"text-right":""),children:t}),(0,y.jsx)("button",{onClick:()=>{o(!n),s(a)},className:"ml-2 p-1 rounded hover:bg-gray-100 transition-colors ".concat(n?"text-indigo-600":"text-gray-400"),title:n?"Unfreeze column":"Freeze column",children:n?(0,y.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,y.jsx)("path",{fillRule:"evenodd",d:"M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z",clipRule:"evenodd"})}):(0,y.jsx)("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:(0,y.jsx)("path",{d:"M5 4a2 2 0 012-2h6a2 2 0 012 2v14l-5-2.5L5 18V4z"})})})]})},j=e=>{var t,s;let{file:a,onError:l,globalFilters:i,onFilterChange:n}=e;const[o,d]=(0,r.useState)([]),[c,j]=(0,r.useState)([]),[w,N]=(0,r.useState)(null),[S,C]=(0,r.useState)(1),[A]=(0,r.useState)(100),[k,E]=(0,r.useState)(null),[T,L]=(0,r.useState)(!0),[F,D]=(0,r.useState)(!1),[R,P]=(0,r.useState)(null),[M,_]=(0,r.useState)(null),[z,I]=((0,r.useMemo)(()=>o[0]||[],[o]),(0,r.useState)("")),[U,O]=(0,r.useState)([]),[B,H]=(0,r.useState)([]),[G,V]=(0,r.useState)([]),W=e=>{n(e.target.name,e.target.value)};(0,r.useEffect)(()=>{let e=!1;return a.id&&(async()=>{try{1!==S||c.length||L(!0);const s=h.default.getInstance(),r={specialty:i.specialty||void 0,providerType:i.providerType||void 0,region:i.region||void 0},{rows:l,pagination:n}=await s.getSurveyData(a.id,r,{page:S,limit:A});if(!e&&l.length>0){j(l);let e=[];try{const t=await h.default.getInstance().getSurveyMeta(a.id);e=Array.isArray(t.columns)&&t.columns.length>0?t.columns:Object.keys(l[0])}catch(t){e=Object.keys(l[0])}e=e.filter(e=>"id"!==e.toLowerCase()&&"surveyid"!==e.toLowerCase());const s=l.map(t=>e.map(e=>String(t[e]||"")));N({columnNames:e,totalRows:l.length,uniqueSpecialties:new Set(l.map(e=>e.specialty)).size,totalDataPoints:l.length*e.length}),d([e,...s])}!e&&n&&E(n),e||L(!1)}catch(s){console.error("Error loading survey data:",s),l("Error loading survey data from backend"),e||L(!1)}})(),()=>{e=!0}},[a.id,S,A]),(0,r.useEffect)(()=>{let e,t=!1;return e=setTimeout(()=>{a.id&&(async()=>{try{D(!0);const s=h.default.getInstance(),r={specialty:i.specialty||void 0,providerType:i.providerType||void 0,region:i.region||void 0},{rows:l,pagination:n}=await s.getSurveyData(a.id,r,{page:1,limit:A});if(!t&&l.length>0){j(l);let t=[];if(o[0]&&o[0].length>0)t=o[0];else try{const e=await h.default.getInstance().getSurveyMeta(a.id);t=Array.isArray(e.columns)&&e.columns.length>0?e.columns:Object.keys(l[0])}catch(e){t=Object.keys(l[0])}t=t.filter(e=>"id"!==e.toLowerCase()&&"surveyid"!==e.toLowerCase());const s=l.map(e=>t.map(t=>String(e[t]||"")));N({columnNames:t,totalRows:l.length,uniqueSpecialties:new Set(l.map(e=>e.specialty)).size,totalDataPoints:l.length*t.length}),d([t,...s]),C(1)}!t&&n&&E(n),t||D(!1)}catch(s){console.error("Error loading filtered data:",s),l("Error loading filtered data from backend"),t||D(!1)}})()},300),()=>{t=!0,clearTimeout(e)}},[i.specialty,i.providerType,i.region,a.id,A]),(0,r.useEffect)(()=>{let e=!1;return a.id&&(async()=>{try{const t=await h.default.getInstance().getAvailableFiltersForSurvey(a.id);if(e)return;O((t.specialties||[]).sort()),H((t.providerTypes||[]).sort()),V((t.regions||[]).sort())}catch(t){}})(),()=>{e=!0}},[a.id]);const q=(0,r.useMemo)(()=>U.length||B.length||G.length?{specialties:U,providerTypes:B,regions:G}:{specialties:[],providerTypes:[],regions:[]},[U,B,G]),Y=(0,r.useMemo)(()=>{if(!c.length||!w)return[];if(c.length>0&&o[0]){const e=o[0];return c.map(t=>e.map(e=>String(t[e]||"")))}return[]},[c,w,o]),K=null!==(t=null===k||void 0===k?void 0:k.pages)&&void 0!==t?t:1,J=(e,t)=>{const s="number"===typeof e?e:parseFloat(String(e).replace(/[^0-9.-]/g,""));return Number.isNaN(s)?null!==e&&void 0!==e?e:"":s.toLocaleString("en-US",{style:"currency",currency:"USD",minimumFractionDigits:t,maximumFractionDigits:t})};return T?(0,y.jsxs)("div",{className:"w-full bg-white shadow-sm",children:[(0,y.jsxs)(g.A,{sx:{display:"flex",flexDirection:"column",p:2,borderBottom:1,borderColor:"divider"},children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,y.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Survey Preview"}),(0,y.jsxs)("button",{disabled:!0,className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-400 cursor-not-allowed",title:"Clear all filters",children:[(0,y.jsx)("div",{className:"relative w-4 h-4 mr-2",children:(0,y.jsx)("svg",{className:"w-4 h-4 text-gray-300",fill:"currentColor",viewBox:"0 0 20 20",children:(0,y.jsx)("path",{d:"M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"})})}),(0,y.jsx)("span",{className:"text-xs",children:"Clear Filters"})]})]}),(0,y.jsx)("div",{className:"grid grid-cols-3 gap-4",children:[...Array(3)].map((e,t)=>(0,y.jsx)("div",{className:"animate-pulse",children:(0,y.jsx)("div",{className:"h-10 bg-gray-200 rounded-md"})},t))})]}),(0,y.jsx)("div",{className:"ag-theme-alpine",style:{height:520,width:"100%"},children:(0,y.jsxs)("div",{className:"animate-pulse",children:[(0,y.jsx)("div",{className:"h-10 bg-gray-200 mb-2"}),[...Array(10)].map((e,t)=>(0,y.jsx)("div",{className:"h-8 bg-gray-100 mb-1"},t))]})})]}):(0,y.jsxs)("div",{className:"w-full bg-white shadow-sm",children:[(0,y.jsxs)(g.A,{sx:{display:"flex",flexDirection:"column",p:2,borderBottom:1,borderColor:"divider"},children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,y.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Survey Preview"}),(0,y.jsxs)("button",{onClick:()=>{n("specialty",""),n("providerType",""),n("region",""),C(1)},className:"inline-flex items-center px-3 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-all duration-200",title:"Clear all filters",children:[(0,y.jsxs)("div",{className:"relative w-4 h-4 mr-2",children:[(0,y.jsx)("svg",{className:"w-4 h-4 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,y.jsx)("path",{d:"M3 3a1 1 0 011-1h12a1 1 0 011 1v3a1 1 0 01-.293.707L12 11.414V15a1 1 0 01-.293.707l-2 2A1 1 0 018 17v-5.586L3.293 6.707A1 1 0 013 6V3z"})}),(i.specialty||i.providerType||i.region)&&(0,y.jsx)("svg",{className:"absolute -top-1 -right-1 w-3 h-3 text-red-500 bg-white rounded-full",fill:"currentColor",viewBox:"0 0 20 20",children:(0,y.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]}),(0,y.jsx)("span",{className:"text-xs",children:"Clear Filters"})]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,y.jsxs)(u.A,{fullWidth:!0,size:"small",children:[(0,y.jsx)(p.A,{className:"text-sm font-medium text-gray-700 mb-2",children:"Specialty"}),(0,y.jsxs)(m.A,{name:"specialty",value:i.specialty,onChange:W,label:"Specialty",className:"h-10",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}},children:[(0,y.jsx)(x.A,{value:"",children:"All"}),q.specialties.map(e=>(0,y.jsx)(x.A,{value:e,children:e},e))]})]}),(0,y.jsxs)(u.A,{fullWidth:!0,size:"small",children:[(0,y.jsx)(p.A,{className:"text-sm font-medium text-gray-700 mb-2",children:"Provider Type"}),(0,y.jsxs)(m.A,{name:"providerType",value:i.providerType,onChange:W,label:"Provider Type",className:"h-10",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}},children:[(0,y.jsx)(x.A,{value:"",children:"All"}),q.providerTypes.map(e=>(0,y.jsx)(x.A,{value:e,children:e},e))]})]}),(0,y.jsxs)(u.A,{fullWidth:!0,size:"small",children:[(0,y.jsx)(p.A,{className:"text-sm font-medium text-gray-700 mb-2",children:"Geographic Region"}),(0,y.jsxs)(m.A,{name:"region",value:i.region,onChange:W,label:"Geographic Region",className:"h-10",sx:{"& .MuiOutlinedInput-root":{borderRadius:"8px"}},children:[(0,y.jsx)(x.A,{value:"",children:"All"}),q.regions.map(e=>(0,y.jsx)(x.A,{value:e,children:e},e))]})]})]})]}),(0,y.jsxs)("div",{className:"ag-theme-alpine relative px-4 py-2 rounded-lg border border-gray-200",style:{height:520,width:"100%"},children:[F&&(0,y.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-50 flex items-center justify-center z-10",children:(0,y.jsxs)("div",{className:"flex items-center space-x-2 text-gray-600",children:[(0,y.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-600"}),(0,y.jsx)("span",{className:"text-sm",children:"Updating data..."})]})}),(0,y.jsx)(r.Suspense,{fallback:(0,y.jsx)(f,{}),children:(0,y.jsx)(v,{onGridReady:e=>{P(e.api),_(e.columnApi)},rowData:Y.map(e=>{const t={};return(o[0]||[]).forEach((s,a)=>{t[s]=e[a]}),t}),columnDefs:(o[0]||[]).filter(e=>{const t=String(e).toLowerCase();return"id"!==t&&"surveyid"!==t}).map(e=>{const t=e,s=e.toLowerCase(),a=s.startsWith("tcc_")||s.includes("total_cash")||s.includes("tcc"),r=s.startsWith("cf_")||s.includes("conversion"),l=s.includes("wrvu"),i="n_orgs"===s||"n_incumbents"===s,n=a||r||l||i,o=s.includes("specialty");return{headerName:e,field:t,sortable:!0,filter:n?"agNumberColumnFilter":"agTextColumnFilter",resizable:!0,cellClass:n?"ag-right-aligned-cell":o?"font-semibold":void 0,headerClass:n?"ag-right-aligned-header":void 0,headerComponent:"CustomHeader",headerComponentParams:{onPinColumn:e=>{if(!M)return;const t=M.getColumn(e),s="left"===(null===t||void 0===t?void 0:t.getColDef().pinned);M.applyColumnState({state:[{colId:e,pinned:s?null:"left"}]})},isSpecialty:o,isNumeric:n},valueGetter:e=>{const s=e.data[t];if(n){const e=parseFloat(String(s).replace(/[^0-9.-]/g,""));return Number.isNaN(e)?null:e}return s},valueFormatter:e=>{var s,n;const o=null!==(s=e.value)&&void 0!==s?s:null===(n=e.data)||void 0===n?void 0:n[t];return void 0===o||null===o?"":a?J(o,0):r?J(o,2):l||i?((e,t)=>{const s="number"===typeof e?e:parseFloat(String(e).replace(/[^0-9.-]/g,""));return Number.isNaN(s)?null!==e&&void 0!==e?e:"":s.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})})(o,0):o}}}),defaultColDef:{sortable:!0,filter:!0,resizable:!0},suppressRowClickSelection:!0,components:{CustomHeader:b},pagination:!1,domLayout:"autoHeight",suppressRowHoverHighlight:!0,rowHeight:40,suppressColumnVirtualisation:!1,suppressHorizontalScroll:!1})})]}),K>1&&(0,y.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-t border-gray-200 bg-white",children:[(0,y.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,y.jsxs)("div",{className:"text-sm text-gray-600",children:["Showing page ",(0,y.jsx)("span",{className:"font-medium text-gray-900",children:S})," of ",(0,y.jsx)("span",{className:"font-medium text-gray-900",children:K})]}),(0,y.jsxs)("div",{className:"text-sm text-gray-500",children:["(",(null===k||void 0===k||null===(s=k.total)||void 0===s?void 0:s.toLocaleString())||0," total records)"]})]}),(0,y.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,y.jsx)("button",{className:"inline-flex items-center px-2.5 py-1.5 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-40 disabled:cursor-not-allowed transition-colors duration-200",onClick:()=>C(1),disabled:S<=1,title:"Go to first page",children:(0,y.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,y.jsx)("path",{fillRule:"evenodd",d:"M15.707 15.707a1 1 0 01-1.414 0l-5-5a1 1 0 010-1.414l5-5a1 1 0 111.414 1.414L11.414 9H17a1 1 0 110 2h-5.586l4.293 4.293a1 1 0 010 1.414z",clipRule:"evenodd"})})}),(0,y.jsx)("button",{className:"inline-flex items-center px-2.5 py-1.5 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-40 disabled:cursor-not-allowed transition-colors duration-200",onClick:()=>C(e=>Math.max(1,e-1)),disabled:S<=1,title:"Previous page",children:(0,y.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,y.jsx)("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),(0,y.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,y.jsx)("span",{className:"text-sm text-gray-500",children:"Page"}),(0,y.jsx)("input",{type:"number",min:"1",max:K,value:S,onChange:e=>{const t=parseInt(e.target.value);t>=1&&t<=K&&C(t)},onKeyPress:e=>{if("Enter"===e.key){const t=parseInt(e.currentTarget.value);t>=1&&t<=K&&C(t)}},className:"w-16 px-2 py-1 text-sm text-center border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",title:"Enter page number (1-".concat(K,")")}),(0,y.jsxs)("span",{className:"text-sm text-gray-500",children:["of ",K]})]}),(0,y.jsx)("button",{className:"inline-flex items-center px-2.5 py-1.5 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-40 disabled:cursor-not-allowed transition-colors duration-200",onClick:()=>C(e=>Math.min(K,e+1)),disabled:S>=K,title:"Next page",children:(0,y.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,y.jsx)("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})}),(0,y.jsx)("button",{className:"inline-flex items-center px-2.5 py-1.5 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 hover:text-gray-700 disabled:opacity-40 disabled:cursor-not-allowed transition-colors duration-200",onClick:()=>C(K),disabled:S>=K,title:"Go to last page",children:(0,y.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:(0,y.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0l5 5a1 1 0 010 1.414l-5 5a1 1 0 01-1.414-1.414L8.586 11H3a1 1 0 110-2h5.586L4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,y.jsxs)("div",{className:"flex items-center space-x-2",children:[S>5&&(0,y.jsx)("button",{className:"px-2 py-1 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded transition-colors duration-200",onClick:()=>C(1),children:"1"}),S>5&&(0,y.jsx)("span",{className:"text-gray-400",children:"..."}),Array.from({length:Math.min(5,K)},(e,t)=>{const s=Math.max(1,Math.min(K-4,S-2))+t;return s>K?null:(0,y.jsx)("button",{className:"px-2 py-1 text-xs rounded transition-colors duration-200 ".concat(s===S?"bg-indigo-600 text-white":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"),onClick:()=>C(s),children:s},s)}),S<K-4&&(0,y.jsx)("span",{className:"text-gray-400",children:"..."}),S<K-4&&(0,y.jsx)("button",{className:"px-2 py-1 text-xs text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded transition-colors duration-200",onClick:()=>C(K),children:K})]})]})]})},w=["SullivanCotter","MGMA","Gallagher","ECG","AMGA"],N=()=>{const[e,t]=(0,r.useState)([]),[s,g]=(0,r.useState)([]),[p,v]=(0,r.useState)(""),[f,b]=(0,r.useState)(""),[N,S]=(0,r.useState)(""),[C,A]=(0,r.useState)(!1),[k,E]=(0,r.useState)(!1),[T,L]=(0,r.useState)(""),[F,D]=(0,r.useState)(null),[R,P]=(0,r.useState)(!0),[M,_]=(0,r.useState)(!1),[z,I]=(0,r.useState)(0),[U,O]=(0,r.useState)(!1),[B,H]=(0,r.useState)(0),[G,V]=(0,r.useState)({specialty:"",providerType:"",region:""}),[W,q]=(0,r.useState)({specialties:new Set,providerTypes:new Set,regions:new Set}),[Y,K]=(0,r.useState)(!1),[J,X]=(0,r.useState)(!1),$=(0,r.useRef)(null),Q=r.useMemo(()=>h.default.getInstance(),[]);(0,r.useEffect)(()=>{const e=e=>{$.current&&!$.current.contains(e.target)&&E(!1)};return k&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[k]),(0,r.useEffect)(()=>{const e={specialties:new Set,providerTypes:new Set,regions:new Set};s.forEach(t=>{if(!t.fileContent)return;const s=t.fileContent.split("\n"),a=s[0].split(",").map(e=>e.trim().toLowerCase()),r=a.findIndex(e=>e.includes("specialty")),l=a.findIndex(e=>e.includes("provider")||e.includes("type")),i=a.findIndex(e=>e.includes("region")||e.includes("geography"));s.slice(1).forEach(t=>{const s=t.split(",").map(e=>e.trim());r>=0&&e.specialties.add(s[r]),l>=0&&e.providerTypes.add(s[l]),i>=0&&e.regions.add(s[i])})}),q(e)},[s]);(0,r.useEffect)(()=>{(async()=>{try{P(!0);const e=await Q.getAllSurveys();console.log("Loaded surveys:",e);const t=e.map(e=>{var t,s,a,r,l,i,n;return{id:e.id,fileName:e.name||"",surveyType:e.type||"",surveyYear:(null===(t=e.year)||void 0===t?void 0:t.toString())||"",uploadDate:new Date(e.uploadDate||new Date),fileContent:"",rows:[],stats:{totalRows:null!==(s=null!==(a=e.rowCount)&&void 0!==a?a:e.row_count)&&void 0!==s?s:0,uniqueSpecialties:null!==(r=null!==(l=e.specialtyCount)&&void 0!==l?l:e.specialty_count)&&void 0!==r?r:0,totalDataPoints:null!==(i=null!==(n=e.dataPoints)&&void 0!==n?n:e.data_points)&&void 0!==i?i:0},columnMappings:{}}});g(t),!F&&t.length>0&&D(t[0].id)}catch(T){console.error("Error loading surveys:",T),re("Error loading saved surveys")}finally{P(!1)}})()},[Q]);const Z=(0,r.useCallback)(e=>{const s=e.map(e=>Object.assign(e,{preview:URL.createObjectURL(e),id:Math.random().toString(36).substring(7)}));t(e=>[...e,...s])},[]),{getRootProps:ee,getInputProps:te}=(0,l.VB)({onDrop:Z,accept:{"text/csv":[".csv"]},multiple:!1,maxFiles:1}),se=(new Date).getFullYear()+10,ae=Array.from({length:se-1990+1},(e,t)=>se-t),re=e=>{L(e),setTimeout(()=>L(""),5e3)};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"w-full min-h-screen",children:(0,y.jsxs)("div",{className:"w-full flex flex-col gap-4",children:[(0,y.jsxs)("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-200 p-6",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,y.jsxs)("div",{className:"flex items-center gap-2",children:[(0,y.jsx)("button",{onClick:()=>K(!Y),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors duration-200","aria-label":Y?"Expand upload section":"Collapse upload section",children:Y?(0,y.jsx)(i.A,{className:"h-5 w-5 text-gray-500"}):(0,y.jsx)(n.A,{className:"h-5 w-5 text-gray-500"})}),(0,y.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Upload New Survey"})]}),(0,y.jsx)("a",{href:"/Provider_Survey_System_Aggregator/sample-survey.csv",download:"sample-survey.csv",className:"inline-flex items-center px-3 py-1.5 text-xs font-medium rounded-md text-indigo-600 bg-indigo-50 hover:bg-indigo-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200",children:"Download Sample"})]}),!Y&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:"grid grid-cols-12 gap-4",children:[(0,y.jsxs)("div",{className:"col-span-4",children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Survey Type"}),(0,y.jsx)(u.A,{fullWidth:!0,children:(0,y.jsxs)(m.A,{value:p,onChange:e=>{const s=e.target.value;A("custom"===s),v(s),t([])},displayEmpty:!0,sx:{backgroundColor:"white",height:"40px","& .MuiOutlinedInput-root":{fontSize:"0.875rem",height:"40px",borderRadius:"8px"},"& .MuiSelect-select":{paddingTop:"8px",paddingBottom:"8px",textAlign:"left"}},children:[(0,y.jsx)(x.A,{value:"",disabled:!0,children:"Select a survey type"}),w.map(e=>(0,y.jsx)(x.A,{value:e,children:e},e)),(0,y.jsx)(x.A,{value:"custom",children:"Custom Survey Type"})]})}),C&&(0,y.jsx)("input",{type:"text",value:f,onChange:e=>b(e.target.value),placeholder:"Enter custom survey type",className:"mt-2 block w-full px-3 py-2 border border-gray-300 rounded-lg\r focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent\r placeholder-gray-400 text-sm transition-colors duration-200"})]}),(0,y.jsxs)("div",{className:"col-span-4",children:[(0,y.jsx)("label",{htmlFor:"surveyYear",className:"block text-sm font-medium text-gray-700 mb-2",children:"Survey Year"}),(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("input",{type:"text",id:"surveyYear",value:N,onChange:e=>{const t=e.target.value;(""===t||/^\d{4}$/.test(t))&&S(t)},onClick:()=>E(!0),onFocus:()=>E(!0),placeholder:"Select year",className:"block w-full px-3 py-2 border border-gray-300 rounded-lg\r focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent\r bg-white text-sm transition-colors duration-200"}),(0,y.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500",children:(0,y.jsx)(o.A,{className:"h-5 w-5"})}),k&&(0,y.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60",ref:$,children:(0,y.jsx)("div",{className:"overflow-y-auto max-h-56",children:ae.map(e=>(0,y.jsx)("button",{onClick:()=>{S(e.toString()),E(!1)},className:"w-full text-left px-3 py-2 text-sm transition-colors duration-200 hover:bg-gray-50\n                                ".concat(N===e.toString()?"bg-indigo-50 text-indigo-600 font-medium":"text-gray-700"),onKeyDown:e=>{"Escape"===e.key&&E(!1)},children:e},e))})})]})]}),(0,y.jsxs)("div",{className:"col-span-4 flex items-end space-x-3",children:[(0,y.jsxs)("div",(0,a.A)((0,a.A)({},ee()),{},{className:"flex-1",children:[(0,y.jsx)("input",(0,a.A)({},te())),(0,y.jsxs)("button",{type:"button",className:"w-full px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200 flex items-center justify-center h-10",children:[(0,y.jsx)(d.A,{className:"h-5 w-5 mr-2"}),"Select File"]})]})),(0,y.jsx)("button",{type:"button",onClick:async()=>{const s=e[0];if(s&&p&&N){_(!0),I(0);try{const e=await Q.uploadSurvey(s,s.name,parseInt(N),C?f:p,e=>I(Math.min(e,100)));I(100),console.log("Survey uploaded successfully:",{surveyId:e.surveyId,rowCount:e.rowCount}),g(t=>[...t,{id:e.surveyId,fileName:s.name,surveyType:C?f:p,surveyYear:N,uploadDate:new Date,fileContent:"",rows:[],stats:{totalRows:e.rowCount,uniqueSpecialties:0,totalDataPoints:e.rowCount},columnMappings:{}}]),D(e.surveyId),t([]),v(""),S(""),b(""),A(!1),setTimeout(()=>{I(0),_(!1)},1e3)}catch(T){console.error("Error uploading survey:",T),re("Upload failed: ".concat(T instanceof Error?T.message:"Unknown error")),_(!1),I(0)}}else re("Please fill in all required fields")},disabled:0===e.length||!p||!N||M,className:"flex-1 px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-white bg-emerald-600 hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center h-10",children:M?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Uploading..."]}):"Upload Survey"})]})]}),e.length>0&&(0,y.jsxs)("div",{className:"mt-6 border-t border-gray-200 pt-4",children:[(0,y.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Selected File"}),(0,y.jsxs)("div",{className:"bg-gray-50 px-3 py-2 rounded-lg flex items-center justify-between",children:[(0,y.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,y.jsxs)("div",{className:"flex items-center text-gray-500",children:[(0,y.jsx)("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,y.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,y.jsx)("span",{className:"text-sm font-medium",children:e[0].name})]}),p&&N&&(0,y.jsxs)("span",{className:"text-sm text-gray-500 bg-gray-100 px-3 py-1 rounded-full",children:[C?f:p," \u2022 ",N]})]}),(0,y.jsx)("button",{onClick:()=>{return e[0].id&&(s=e[0].id,t(e=>{const t=e.find(e=>e.id===s);return null!==t&&void 0!==t&&t.preview&&URL.revokeObjectURL(t.preview),[]}),void D(null));var s},className:"text-gray-400 hover:text-red-500 transition-colors duration-200 p-1 rounded-full hover:bg-gray-100",children:(0,y.jsx)(c.A,{className:"h-5 w-5"})})]})]})]})]}),(0,y.jsxs)("div",{className:"w-full bg-white rounded-xl shadow-sm border border-gray-200 p-4 overflow-visible",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,y.jsxs)("div",{className:"flex items-center gap-2",children:[(0,y.jsx)("button",{onClick:()=>X(!J),className:"p-1 hover:bg-gray-100 rounded-lg transition-colors duration-200","aria-label":J?"Expand uploaded surveys section":"Collapse uploaded surveys section",children:J?(0,y.jsx)(i.A,{className:"h-5 w-5 text-gray-500"}):(0,y.jsx)(n.A,{className:"h-5 w-5 text-gray-500"})}),(0,y.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"Uploaded Surveys"})]}),s.length>0&&(0,y.jsxs)("button",{onClick:async()=>{try{if(!window.confirm("This will delete ALL surveys from Azure. Type OK to proceed."))return;O(!0),H(10),await Q.deleteAllSurveys(),H(90),g([]),D(null)}catch(T){console.error("Error clearing all surveys:",T),re("Error clearing surveys")}finally{H(100),setTimeout(()=>{O(!1),H(0)},600)}},className:"inline-flex items-center px-3 py-1.5 text-xs font-medium text-red-600 hover:text-red-700 transition-colors duration-200 rounded-lg hover:bg-red-50",children:[(0,y.jsx)(c.A,{className:"h-4 w-4 mr-1.5"}),"Clear All"]})]}),!J&&(0,y.jsx)(y.Fragment,{children:R?(0,y.jsxs)("div",{className:"text-center py-6",children:[(0,y.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-500 mx-auto"}),(0,y.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"Loading surveys..."})]}):0===s.length?(0,y.jsx)("div",{className:"text-center py-8 bg-gray-50 rounded-xl",children:(0,y.jsx)("p",{className:"text-gray-500",children:"No surveys uploaded yet"})}):(0,y.jsx)("div",{className:"relative z-10 flex items-center gap-2 overflow-x-auto overflow-y-visible whitespace-nowrap pb-1",children:s.map(e=>{const t=F===e.id,s=(e=>{if(!e||0===e.length)return{totalRows:0,uniqueSpecialties:0,totalDataPoints:0};const t=new Set(e.map(e=>"string"===typeof e.specialty?e.specialty.toLowerCase():void 0).filter(Boolean));return{totalRows:e.length,uniqueSpecialties:t.size,totalDataPoints:e.length*Object.keys(e[0]||{}).length}})(e.rows),a="SullivanCotter"===e.surveyType?"#818CF8":"MGMA"===e.surveyType?"#34D399":"Gallagher"===e.surveyType?"#F472B6":"ECG"===e.surveyType?"#FBBF24":"AMGA"===e.surveyType?"#60A5FA":"#9CA3AF";return(0,y.jsxs)("div",{className:"relative group inline-flex items-center",children:[(0,y.jsxs)("button",{onClick:()=>D(e.id),className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm rounded-full border transition-colors duration-200 ".concat(t?"bg-indigo-600 text-white border-indigo-600":"bg-gray-50 text-gray-700 border-gray-200 hover:bg-gray-100"),title:"".concat(e.surveyType," \u2022 ").concat(e.surveyYear),children:[(0,y.jsx)("span",{className:"font-medium",children:e.surveyType}),(0,y.jsx)("span",{className:"text-xs ".concat(t?"text-indigo-100":"text-gray-500"),children:e.surveyYear})]}),(0,y.jsx)("button",{onClick:t=>(async(e,t)=>{null===t||void 0===t||t.stopPropagation();try{await Q.deleteSurvey(e),g(t=>t.filter(t=>t.id!==e)),F===e&&D(null)}catch(T){console.error("Error removing survey:",T),re("Error removing survey")}})(e.id,t),className:"ml-1 text-gray-400 hover:text-red-500 p-1 rounded-full hover:bg-gray-100",title:"Remove survey",children:(0,y.jsx)(c.A,{className:"h-4 w-4"})}),(0,y.jsx)("div",{className:"pointer-events-none absolute z-50 -top-32 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:(0,y.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 p-3 w-64",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,y.jsxs)("div",{className:"text-xs font-medium text-gray-900",children:[e.surveyType," \u2022 ",e.surveyYear]}),(0,y.jsx)("div",{className:"text-[10px] text-gray-500",children:new Date(e.uploadDate).toLocaleDateString()})]}),(0,y.jsxs)("div",{className:"grid grid-cols-3 gap-3 text-center",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-base font-semibold text-gray-900",children:s.totalRows.toLocaleString()}),(0,y.jsx)("div",{className:"text-[10px] text-gray-500 mt-0.5",children:"Rows"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-base font-semibold text-gray-900",children:s.uniqueSpecialties.toLocaleString()}),(0,y.jsx)("div",{className:"text-[10px] text-gray-500 mt-0.5",children:"Specialties"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"text-base font-semibold text-gray-900",children:s.totalDataPoints.toLocaleString()}),(0,y.jsx)("div",{className:"text-[10px] text-gray-500 mt-0.5",children:"Data Points"})]})]}),(0,y.jsx)("div",{className:"mt-2 h-1.5 rounded-full",style:{backgroundColor:a}})]})})]},e.id)})})})]}),F&&(0,y.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:(0,y.jsx)("div",{className:"w-full overflow-x-auto",children:(0,y.jsx)(j,{file:s.find(e=>e.id===F),onError:re,globalFilters:G,onFilterChange:(e,t)=>{V(s=>(0,a.A)((0,a.A)({},s),{},{[e]:t}))}})})})]})}),M&&(0,y.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",role:"dialog","aria-modal":"true","aria-labelledby":"upload-modal-title",children:(0,y.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 w-full max-w-md p-6",children:[(0,y.jsxs)("div",{className:"flex items-start justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h3",{id:"upload-modal-title",className:"text-lg font-semibold text-gray-900",children:"Uploading survey\u2026"}),(0,y.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Please keep this tab open while we process your file."})]}),(0,y.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-indigo-200 border-t-indigo-600 animate-spin","aria-hidden":"true"})]}),(0,y.jsxs)("div",{className:"mt-5",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,y.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),(0,y.jsxs)("span",{className:"text-sm text-gray-500",children:[z,"%"]})]}),(0,y.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,y.jsx)("div",{className:"h-2.5 rounded-full transition-all duration-300 ease-out bg-emerald-600",style:{width:"".concat(z,"%")}})}),(0,y.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:z<100?"Processing survey data\u2026":"Upload complete! Finalizing\u2026"})]})]})}),U&&(0,y.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40",role:"dialog","aria-modal":"true","aria-labelledby":"delete-modal-title",children:(0,y.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 w-full max-w-md p-6",children:[(0,y.jsxs)("div",{className:"flex items-start justify-between",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h3",{id:"delete-modal-title",className:"text-lg font-semibold text-gray-900",children:"Clearing surveys\u2026"}),(0,y.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Deleting all surveys from Azure. This can take a few seconds."})]}),(0,y.jsx)("div",{className:"w-6 h-6 rounded-full border-2 border-indigo-200 border-t-indigo-600 animate-spin","aria-hidden":"true"})]}),(0,y.jsxs)("div",{className:"mt-5",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,y.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Progress"}),(0,y.jsxs)("span",{className:"text-sm text-gray-500",children:[B,"%"]})]}),(0,y.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:(0,y.jsx)("div",{className:"h-2.5 rounded-full transition-all duration-300 ease-out bg-red-600",style:{width:"".concat(B,"%")}})}),(0,y.jsx)("div",{className:"mt-3 text-xs text-gray-500",children:B<100?"Removing survey data\u2026":"All surveys cleared."})]})]})})]})}}}]);
//# sourceMappingURL=26.3f0a8342.chunk.js.map